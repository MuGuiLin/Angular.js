<br>
<br>
<h1>Angular ä¸­çš„å¸¸è§æ•°æ®äº¤äº’ï¼ˆgetã€postã€jsonpï¼‰ï¼Œä»¥åŠç¬¬ä¸‰æ–¹å·¥å…· Axios <h4 style="font-size: 16px; color: red;"> </h4>
</h1>
<hr>
<section class="getData">
    <pre>
        Angular5.x ä»¥å getã€post å’Œå’ŒæœåŠ¡å™¨äº¤äº’ä½¿ç”¨çš„æ˜¯ HttpClientModule æ¨¡å—ã€‚ 

        1ã€åœ¨ app.module.ts ä¸­å¼•å…¥ HttpClientModule å¹¶æ³¨å…¥ 
        <code>
            import {{HttpClientModule} from '@angular/common/http'; 

            // åœ¨importsä¸­ä¾èµ–æ³¨å…¥æ¨¡å—
            imports: [ BrowserModule, HttpClientModule ]
        </code>
        
        2ã€åœ¨ç”¨åˆ°çš„åœ°æ–¹å¼•å…¥ HttpClient å¹¶åœ¨æ„é€ å‡½æ•°å£°æ˜ 
        <code>
            import {HttpClient, HttpHeaders} from "@angular/common/http"; 

            // åœ¨æ„é€ å‡½æ•°å£°æ˜
            constructor(public http:HttpClient) { 

            }

            //const httpOptions = { headers: new HttpHeaders({ 'Content-Type': 'application/json' }) }; //è®¾ç½®è¯·æ±‚å¤´
        </code>
    </pre>

    <br>
    <br>
    <h2>1ã€Angular å†…ç½®æ•°æ®è¯·æ±‚ ä¹‹ GET </h2>
    <pre>
        <code>{{getData | json}}ï¼Œç”±äºè¦å±•ç¤ºæºä»£ç ï¼Œè€Œæºä»£ç ä¸­æœ‰{{ï¼Œå¦‚æœæ˜¯1ä¸ªèŠ±æ‹¬å·é¡µé¢å°±ä¼šæŠ¥é”™ï¼Œæ˜¯2ä¸ªå°±ä¸æŠ¥é”™ï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´åœ¨ æ­£å¸¸çš„åŒèŠ±æ‹¬å·ä¸­çš„æ•°æ®ä¸èƒ½æ˜¾ç¤ºï¼Œä¸ºäº†å±•ç¤ºä»£ç ï¼Œåªå¥½å…ˆè¿™æ ·ï¼ï¼</code>

        å®ä¾‹ä»£ç ï¼š
        <code>
            let api = "http://a.itying.com/api/productlist";

            this.http.get(api, {{
                params: {
                  id: '106',
                  page: '5'
                }
              }).subscribe((res: any) => {

                console.log(res);
            });
        </code>
    </pre>

    <ul class="father">
        <li *ngFor="let item of getData">

            <h3>ğŸ¥¦{{item.title}}ï¼š</h3>
            <ul class="child">
                <li *ngFor="let item of item.list">
                    <h5>{{item.title}}</h5>
                    <img [src]="__URL__ + '/' + filterPath(item.img_url)" alt="" />
                    <p>ï¿¥{{item.price | number: '1.2'}}</p>
                </li>
            </ul>
            <br>
        </li>
    </ul>
    <button (click)="httpGet()">Angularå†…ç½®æ•°æ®è¯·æ±‚æ¨¡å—ï¼šGETè¯·æ±‚</button>

    <br>
    <br>
    <h2>2ã€Angular å†…ç½®æ•°æ®è¯·æ±‚ ä¹‹ POST </h2>
    <pre>
        <code>{{ postData | json}}</code>

        å®ä¾‹ä»£ç ï¼š
        <code>
            const httpOptions = {{ headers: new HttpHeaders({ 'Content-Type': 'application/json' }) };

            let api = "http://127.0.0.1:3000/doLogin";
            
            this.http.post(api, {
              name: 'mupiao',
              pwds: 123456
            }, httpOptions).subscribe((res: any) => {

              console.log(res);
            });
        </code>
    </pre>

    <button (click)="httpPost()">Angularå†…ç½®æ•°æ®è¯·æ±‚æ¨¡å—ï¼šPOSTè¯·æ±‚</button>

    <br>
    <br>
    <h2>3ã€Angular å†…ç½®æ•°æ®è¯·æ±‚ ä¹‹ JSONP </h2>
    <pre>
        <code>{{jsonpData | json}}</code>
        
        <span style="color: red;">
        æ³¨ï¼šjsonpéœ€è¦åç«¯æœåŠ¡å™¨APIæ”¯æŒæ‰è¡Œå“¦ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥è¿”å›æ•°æ®ï¼Œä¸€èˆ¬jsonpè¯·æ±‚è¿”å›çš„æ˜¯ä¸€ä¸ªjsæ–‡ä»¶ï¼ï¼

        å¦‚ï¼šhttp://a.itying.com/api/productlist?callback=xxx;

        æˆ–ï¼šhttp://a.itying.com/api/productlist?cb=xxx;

        JSONPçš„å…¨ç§°æ˜¯JSON with Paddingï¼Œç”±äºåŒæºç­–ç•¥çš„é™åˆ¶ï¼ŒXmlHttpRequeståªå…è®¸è¯·æ±‚å½“å‰æºï¼ˆåè®®ï¼ŒåŸŸåï¼Œç«¯å£ï¼‰çš„èµ„æº --> åŒæºç­–ç•¥ã€‚
        
        å¦‚æœè¦è¿›è¡Œè·¨åŸŸè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨htmlçš„scriptæ ‡è®°æ¥è¿›è¡Œè·¨åŸŸè¯·æ±‚ï¼Œå¹¶åœ¨ç›¸åº”ä¸­è¿”å›è¦æ‰§è¡Œçš„scriptä»£ç ï¼Œå…¶ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨JSONä¼ é€’javascriptå¯¹è±¡ã€‚
        
        è¿™ç§è·¨åŸŸçš„é€šè®¯æ–¹å¼æˆä¸ºJSONPï¼Œå®ƒæ˜¯ä¸ºå®ç°è·¨åŸŸï¼Œè€Œé‡‡ç”¨çš„ä¸€ç§è„šæœ¬æ³¨å…¥æ–¹æ³•ã€‚
        </span>

        1ã€åœ¨ app.module.ts ä¸­å¼•å…¥ HttpClientModule, HttpClientJsonpModule å¹¶æ³¨å…¥è¿™ä¸¤ä¸ªæ¨¡å—
        <code>
            import {{HttpClientModule, HttpClientJsonpModule} from '@angular/common/http'; 

            // åœ¨importsä¸­ä¾èµ–æ³¨å…¥æ¨¡å—
            imports: [ BrowserModule, HttpClientModule, HttpClientJsonpModule ]
        </code>
        
        2ã€åœ¨ç”¨åˆ°çš„åœ°æ–¹å¼•å…¥ HttpClient å¹¶åœ¨æ„é€ å‡½æ•°å£°æ˜ 
        <code>
            import {HttpClient, HttpHeaders} from "@angular/common/http"; 

            // åœ¨æ„é€ å‡½æ•°å£°æ˜
            constructor(public http:HttpClient) { 

            }

            //const httpOptions = { headers: new HttpHeaders({ 'Content-Type': 'application/json' }) }; //è®¾ç½®è¯·æ±‚å¤´
        </code>

        å®ä¾‹ä»£ç ï¼š
        <code>
            let api = "http://a.itying.com/api/productlist";

            this.http.jsonp(api, 'callback').subscribe((res: any) => {{

                console.log(res);
            });
        </code>

    </pre>

    <button (click)="httpJsonp()">Angularå†…ç½®æ•°æ®è¯·æ±‚æ¨¡å—ï¼šJSONPè¯·æ±‚</button>

    <br>
    <br>
    <h2>4ã€Angular ç¬¬3æ–¹æ¨¡å— æ•°æ®è¯·æ±‚ ä¹‹ Axios </h2>
    <pre>

        1ã€å®‰è£…axiosæ¨¡å— 
        <code>
            // Using ç”¨npmå®‰è£…:
                npm install axios

            // Using ç”¨bowerå®‰è£…:
                bower install axios
            
            // Using ç”¨yarnå®‰è£…:
                yarn add axios
        </code>
        
        2ã€åœ¨ç”¨åˆ°çš„åœ°æ–¹å¼•å…¥ axios å¹¶åœ¨æ„é€ å‡½æ•°å£°æ˜ 
        <code>
            import axios from "axios";
        </code>

        2ã€1 å¯ä»¥å°è£…servicesæœåŠ¡ä¸­
        <code>
            // 1ã€åœ¨å‘½ä»¤è¡Œä¸­ åˆ›å»º axiosæœåŠ¡
            ng g s services/axios

            // 2ã€åœ¨ services/axios.service.ts æ–‡ä»¶ä¸­å°è£…
            import axios from "axios";

            // 3ã€ç”¨Promiseå°è£…ä¸€ä¸ªgetæ–¹å¼çš„è¯·æ±‚

            axiosGet(obj) {
                return new Promise((resovle, reject) => {
                  axios.get(obj.url, {
                    params: obj.params
                  })
                  .then(function (response) {
                    resovle(response);
                  })
                  .catch(function (error) {
                    reject(error);
                  })
                  .finally(function () {
                    obj.finally && obj.finally();
                  });  
                })
            
              };
        </code>

        å®ä¾‹ä»£ç ï¼š
        <code>
            let api = this.__URL__ + "/api/productlist";

            this.axios.axiosGet({url: api}).then((res: any) => {

            console.log('åœ¨æœåŠ¡ä¸­å°è£…çš„axios', res.data);
            }, (err) => {

            console.log(err);
            })
        </code>
    </pre>

    <button (click)="axiosGet()">Angularç¬¬ä¸‰æ–¹axiosæ•°æ®è¯·æ±‚æ¨¡å—ï¼šGETè¯·æ±‚</button>

</section>